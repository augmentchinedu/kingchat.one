import{_ as H}from"./SideBar-Bxipw9r_.js";import{u as $,r as L,n as T,B as z,o as s,g as c,F as R,q as S,e as a,h as B,f as i,t as D,z as q,C as O,p as j,m as W,D as I,d as o,E as G,c as J,w as g,k as K,b as _,v as P}from"./index-C5_W0Ht1.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Q}from"./Messenger-B60b61th.js";const M=h=>(j("data-v-b40407ce"),h=h(),W(),h),X={key:0,id:"unread-tag",class:"text-center"},Y=M(()=>i("span",{class:"text-xl underline"},"Unread Messages",-1)),Z=[Y],ee={class:"flex flex-row gap-1 float-right text-xs"},te={id:"time"},ae={key:0,id:"reciept",class:"grid items-center"},ne={key:0,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},se=M(()=>i("path",{fill:"currentColor",stroke:"#43A047",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),oe=[se],ie={key:1,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},re=M(()=>i("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),le=[re],ce={key:2,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},de=M(()=>i("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M21 7L9 19l-5.5-5.5l1.41-1.41L9 16.17L19.59 5.59z"},null,-1)),ue=[de],me={key:3,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},_e=O('<circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-b40407ce><animateTransform attributeName="transform" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="0 12 12;90 12 12;180 12 12;270 12 12" data-v-b40407ce></animateTransform><animate attributeName="opacity" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-b40407ce></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-b40407ce><animateTransform attributeName="transform" begin="0.2s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="30 12 12;120 12 12;210 12 12;300 12 12" data-v-b40407ce></animateTransform><animate attributeName="opacity" begin="0.2s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-b40407ce></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-b40407ce><animateTransform attributeName="transform" begin="0.4s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="60 12 12;150 12 12;240 12 12;330 12 12" data-v-b40407ce></animateTransform><animate attributeName="opacity" begin="0.4s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-b40407ce></animate></circle>',3),ve=[_e],pe=["time"],fe={__name:"Bubbles",props:["chat"],setup(h,{expose:k}){const v=$(),{chat:t}=h,r=L(null);k({bubbleDiv:r});const d=v.user.uid,p=t._id.split(d).find(n=>n.length>0);let l;const f=T(()=>t.meta);let m=T(()=>{let n={};return n.read=t.messages.filter(u=>u.time<f.value[d].lastRead),n.unread=t.messages.filter(u=>u.time>f.value[d].lastRead),n});function b(){let u={root:null,rootMargin:`0px 0px -${r.value.parentElement.children[1].offsetHeight}px 0px`,threshold:0};l=new IntersectionObserver(N,u);let x=[],y=r.value.children;for(let e of y){const C=e.children[0].children[0].children[1].children[1];C.getAttribute("time")&&x.push(C)}x.forEach(e=>{e.getAttribute("time")>f.value[d].lastRead&&l.observe(e)})}z(()=>{new MutationObserver(()=>b()).observe(r.value,{childList:!0})});function w(n){return v.user.uid==n?"right":"left"}function N(n){n.forEach(u=>{if(u.isIntersecting){const x=u.target.getAttribute("time");x>f.value[d].lastRead&&(console.log("Sending Read Reciept"),v.sendReciept(t._id,{lastRead:x}),l.unobserve(u.target))}})}return(n,u)=>(s(),c("div",{id:"bubbleDiv",ref_key:"bubbleDiv",ref:r},[(s(!0),c(R,null,S(a(m),(x,y)=>(s(),c(R,{key:y},[y=="unread"&&a(m).length>0?(s(),c("div",X,Z)):B("",!0),(s(!0),c(R,null,S(a(m)[y],(e,C)=>(s(),c("div",{key:C,ref_for:!0,ref:y,class:"grid mx-2 my-4"},[i("div",{class:q(["bubble shadow-sm",{left:w(e.sender)=="left",right:w(e.sender)=="right"}])},[i("div",null,[i("div",null,D(e.text),1),i("div",ee,[i("div",te,D(a(v).formatTimeDisplay(e.time)),1),w(e.sender)=="right"?(s(),c("div",ae,[f.value[a(p)].lastRead>=e.time?(s(),c("svg",ne,oe)):f.value[a(p)].lastDelivered>e.time?(s(),c("svg",ie,le)):f.value[a(d)].lastSent>e.time?(s(),c("svg",ce,ue)):f.value[a(d)].lastSent<e.time?(s(),c("svg",me,ve)):B("",!0)])):B("",!0),w(e.sender)=="left"?(s(),c("div",{key:1,time:e.time},null,8,pe)):B("",!0)])])],2)]))),128))],64))),128))],512))}},he=V(fe,[["__scopeId","data-v-b40407ce"]]),be={__name:"Chat",props:["active","to"],setup(h){const k=L(null),v=L(null),t=L(null);function r(){const d=t.value.widgetDiv.offsetHeight,p=k.value.offsetWidth;v.value.bubbleDiv.style.width=p+"px",v.value.bubbleDiv.style.marginBottom=d+"px",t.value.widgetDiv.style.margin="auto",t.value.widgetDiv.style.width=p+"px"}return z(()=>{r(),window.addEventListener("resize",r)}),I(()=>window.removeEventListener("resize",r)),(d,p)=>(s(),c("div",{class:"flex flex-col h-full",ref_key:"page",ref:k},[o(he,{chat:h.active,class:"w-full text-sm",ref_key:"chat",ref:v},null,8,["chat"]),o(Q,{class:"messenger w-full",to:h.to,ref_key:"widget",ref:t},null,8,["to"])],512))}},ge=V(be,[["__scopeId","data-v-6f5585ab"]]),we=i("br",null,null,-1),xe={class:"text-xs"},Be={__name:"Chat",setup(h){const k=L(!1),{back:v}=P("app"),t=$(),r=K(),d=r.query.origin;let p;switch(d){case"/home":p="recent";break;case"/chats":p="chats";break}let l=t.chats.find(m=>m.profile.username==r.params.username);if(!l){let{_id:m,profile:b}=t[p].find(w=>w.profile.username==r.params.username);console.log(m,b),l=t.createNewChat(m,b)}const f=G({type:"Chat",chatid:l._id});return I(()=>{t.chats=t.chats.filter(m=>m.messages.length>0)}),(m,b)=>{const w=_("v-navigation-drawer"),N=_("v-icon"),n=_("v-app-bar-nav-icon"),u=_("v-img"),x=_("v-avatar"),y=_("router-link"),e=_("v-app-bar-title"),C=_("v-app-bar"),F=_("v-container"),A=_("v-main"),U=_("v-app");return s(),J(U,null,{default:g(()=>[o(w,{modelValue:k.value,"onUpdate:modelValue":b[0]||(b[0]=E=>k.value=E)},{default:g(()=>[o(H)]),_:1},8,["modelValue"]),o(C,{elevation:2,color:"red-darken-1"},{default:g(()=>[o(n,{onClick:b[1]||(b[1]=E=>a(v)())},{default:g(()=>[o(N,{icon:"mdi-keyboard-backspace"})]),_:1}),o(x,null,{default:g(()=>[o(u,{alt:a(l).profile.displayName,src:a(l).profile.photoURL},null,8,["alt","src"])]),_:1}),o(e,null,{default:g(()=>[o(y,{to:"../"+a(l).profile.username},{default:g(()=>[i("div",null,[i("p",null,[i("span",null,D(a(l).profile.displayName),1),we,i("span",xe,"@"+D(a(l).profile.username),1)])])]),_:1},8,["to"])]),_:1})]),_:1}),o(A,null,{default:g(()=>[o(F,{class:"ma-0 pa-0 mx-auto h-full"},{default:g(()=>[o(ge,{active:a(l),to:f},null,8,["active","to"])]),_:1})]),_:1})]),_:1})}}};export{Be as default};
