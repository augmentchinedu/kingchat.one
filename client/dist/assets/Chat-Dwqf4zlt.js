import{_ as H}from"./SideBar-rJE7UNkJ.js";import{u as $,r as L,v as T,o as z,c as n,j as c,F as D,x as S,g as a,k as B,h as i,t as M,C as j,E as q,q as O,s as G,a as I,f as o,G as W,b as _,d as J,w as g,m as K,z as P}from"./index-jq0NkvVs.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Q}from"./Messenger-Dgw9vy8l.js";const N=h=>(O("data-v-b40407ce"),h=h(),G(),h),X={key:0,id:"unread-tag",class:"text-center"},Y=N(()=>i("span",{class:"text-xl underline"},"Unread Messages",-1)),Z=[Y],ee={class:"flex flex-row gap-1 float-right text-xs"},te={id:"time"},ae={key:0,id:"reciept",class:"grid items-center"},se={key:0,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},ne=N(()=>i("path",{fill:"currentColor",stroke:"#43A047",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),oe=[ne],ie={key:1,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},re=N(()=>i("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),le=[re],ce={key:2,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},de=N(()=>i("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M21 7L9 19l-5.5-5.5l1.41-1.41L9 16.17L19.59 5.59z"},null,-1)),ue=[de],me={key:3,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},_e=q('<circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-b40407ce><animateTransform attributeName="transform" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="0 12 12;90 12 12;180 12 12;270 12 12" data-v-b40407ce></animateTransform><animate attributeName="opacity" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-b40407ce></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-b40407ce><animateTransform attributeName="transform" begin="0.2s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="30 12 12;120 12 12;210 12 12;300 12 12" data-v-b40407ce></animateTransform><animate attributeName="opacity" begin="0.2s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-b40407ce></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-b40407ce><animateTransform attributeName="transform" begin="0.4s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="60 12 12;150 12 12;240 12 12;330 12 12" data-v-b40407ce></animateTransform><animate attributeName="opacity" begin="0.4s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-b40407ce></animate></circle>',3),ve=[_e],pe=["time"],fe={__name:"Bubbles",props:["chat"],setup(h,{expose:k}){const v=$(),{chat:t}=h,r=L(null);k({bubbleDiv:r});const d=v.user.uid,p=t._id.split(d).find(s=>s.length>0);let l;const f=T(()=>t.meta);let m=T(()=>{let s={};return s.read=t.messages.filter(u=>u.time<f.value[d].lastRead),s.unread=t.messages.filter(u=>u.time>f.value[d].lastRead),s});function b(){let u={root:null,rootMargin:`0px 0px -${r.value.parentElement.children[1].offsetHeight}px 0px`,threshold:0};l=new IntersectionObserver(R,u);let x=[],y=r.value.children;for(let e of y){const C=e.children[0].children[0].children[1].children[1];C.getAttribute("time")&&x.push(C)}x.forEach(e=>{e.getAttribute("time")>f.value[d].lastRead&&l.observe(e)})}z(()=>{new MutationObserver(()=>b()).observe(r.value,{childList:!0})});function w(s){return v.user.uid==s?"right":"left"}function R(s){s.forEach(u=>{if(u.isIntersecting){const x=u.target.getAttribute("time");x>f.value[d].lastRead&&(console.log("Sending Read Reciept"),v.sendReciept(t._id,{lastRead:x}),l.unobserve(u.target))}})}return(s,u)=>(n(),c("div",{id:"bubbleDiv",ref_key:"bubbleDiv",ref:r},[(n(!0),c(D,null,S(a(m),(x,y)=>(n(),c(D,{key:y},[y=="unread"&&a(m).length>0?(n(),c("div",X,Z)):B("",!0),(n(!0),c(D,null,S(a(m)[y],(e,C)=>(n(),c("div",{key:C,ref_for:!0,ref:y,class:"grid mx-2 my-4"},[i("div",{class:j(["bubble shadow-sm",{left:w(e.sender)=="left",right:w(e.sender)=="right"}])},[i("div",null,[i("div",null,M(e.text),1),i("div",ee,[i("div",te,M(a(v).formatTimeDisplay(e.time)),1),w(e.sender)=="right"?(n(),c("div",ae,[f.value[a(p)].lastRead>=e.time?(n(),c("svg",se,oe)):f.value[a(p)].lastDelivered>e.time?(n(),c("svg",ie,le)):f.value[a(d)].lastSent>e.time?(n(),c("svg",ce,ue)):f.value[a(d)].lastSent<e.time?(n(),c("svg",me,ve)):B("",!0)])):B("",!0),w(e.sender)=="left"?(n(),c("div",{key:1,time:e.time},null,8,pe)):B("",!0)])])],2)]))),128))],64))),128))],512))}},he=V(fe,[["__scopeId","data-v-b40407ce"]]),be={__name:"Chat",props:["active","to"],setup(h){const k=L(null),v=L(null),t=L(null);function r(){const d=t.value.widgetDiv.offsetHeight,p=k.value.offsetWidth;v.value.bubbleDiv.style.width=p+"px",v.value.bubbleDiv.style.marginBottom=d+"px",t.value.widgetDiv.style.margin="auto",t.value.widgetDiv.style.width=p+"px"}return z(()=>{r(),window.addEventListener("resize",r)}),I(()=>window.removeEventListener("resize",r)),(d,p)=>(n(),c("div",{class:"flex flex-col h-full",ref_key:"page",ref:k},[o(he,{chat:h.active,class:"w-full text-sm",ref_key:"chat",ref:v},null,8,["chat"]),o(Q,{class:"messenger w-full",to:h.to,ref_key:"widget",ref:t},null,8,["to"])],512))}},ge=V(be,[["__scopeId","data-v-6f5585ab"]]),we=i("br",null,null,-1),xe={class:"text-xs"},Be={__name:"Chat",setup(h){const k=L(!1),{back:v}=P("app"),t=$(),r=K(),d=r.query.origin;let p;switch(d){case"/home":p="recent";break;case"/chats":p="chats";break}let l=t.chats.find(m=>m.profile.username==r.params.username);if(!l){let{_id:m,profile:b}=t[p].find(w=>w.profile.username==r.params.username);console.log(m,b),l=t.createNewChat(m,b)}const f=W({type:"Chat",chatid:l._id});return I(()=>{t.chats=t.chats.filter(m=>m.messages.length>0)}),(m,b)=>{const w=_("v-navigation-drawer"),R=_("v-icon"),s=_("v-app-bar-nav-icon"),u=_("v-img"),x=_("v-avatar"),y=_("router-link"),e=_("v-app-bar-title"),C=_("v-app-bar"),F=_("v-container"),A=_("v-main"),U=_("v-app");return n(),J(U,null,{default:g(()=>[o(w,{modelValue:k.value,"onUpdate:modelValue":b[0]||(b[0]=E=>k.value=E)},{default:g(()=>[o(H)]),_:1},8,["modelValue"]),o(C,{elevation:2,color:"red-darken-1"},{default:g(()=>[o(s,{onClick:b[1]||(b[1]=E=>a(v)())},{default:g(()=>[o(R,{icon:"mdi-keyboard-backspace"})]),_:1}),o(x,null,{default:g(()=>[o(u,{alt:a(l).profile.displayName,src:a(l).profile.photoURL},null,8,["alt","src"])]),_:1}),o(e,null,{default:g(()=>[o(y,{to:"../"+a(l).profile.username},{default:g(()=>[i("div",null,[i("p",null,[i("span",null,M(a(l).profile.displayName),1),we,i("span",xe,"@"+M(a(l).profile.username),1)])])]),_:1},8,["to"])]),_:1})]),_:1}),o(A,null,{default:g(()=>[o(F,{class:"ma-0 pa-0 mx-auto h-full"},{default:g(()=>[o(ge,{active:a(l),to:f},null,8,["active","to"])]),_:1})]),_:1})]),_:1})}}};export{Be as default};
