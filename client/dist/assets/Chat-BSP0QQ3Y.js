import{_ as A,f as I,g as S,r as F,D,o as s,h as r,F as T,j as B,E as k,G as $,t as x,u as a,d as l,H as U,I as j,p as q,n as G,k as E,c as H,w as v,e as J,a as u,b as i,i as V}from"./index-Bxjf4WUl.js";import{_ as O}from"./SideBar-6fsG41zE.js";import{_ as K}from"./Messenger-CXedN3Nv.js";const C=h=>(q("data-v-253d7a4b"),h=h(),G(),h),P={class:"h-full"},Q={key:0,id:"unread-tag",class:"text-center"},W=C(()=>l("span",{class:"text-xl"},"Unread Messages",-1)),X=[W],Y={class:"flex flex-row gap-1 float-right text-xs"},Z={id:"time"},ee={key:0,id:"reciept",class:"grid items-center"},te={key:0,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},ae=C(()=>l("path",{fill:"currentColor",stroke:"#43A047",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),oe=[ae],se={key:1,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},ne=C(()=>l("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),re=[ne],ie={key:2,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},le=C(()=>l("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M21 7L9 19l-5.5-5.5l1.41-1.41L9 16.17L19.59 5.59z"},null,-1)),ce=[le],de={key:3,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},ue=j('<circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-253d7a4b><animateTransform attributeName="transform" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="0 12 12;90 12 12;180 12 12;270 12 12" data-v-253d7a4b></animateTransform><animate attributeName="opacity" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-253d7a4b></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-253d7a4b><animateTransform attributeName="transform" begin="0.2s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="30 12 12;120 12 12;210 12 12;300 12 12" data-v-253d7a4b></animateTransform><animate attributeName="opacity" begin="0.2s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-253d7a4b></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-253d7a4b><animateTransform attributeName="transform" begin="0.4s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="60 12 12;150 12 12;240 12 12;330 12 12" data-v-253d7a4b></animateTransform><animate attributeName="opacity" begin="0.4s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-253d7a4b></animate></circle>',3),_e=[ue],me=["time"],pe={__name:"Chat",props:["chat"],setup(h){const f=I(),{chat:_}=h,t=f.user.uid,L=_._id.split(t).find(e=>e.length>0),n=S(()=>_.meta);console.log(n.value[t]);let c=S(()=>{let e={};return e.read=_.messages.filter(d=>d.time<n.value[t].lastRead),e.unread=_.messages.filter(d=>d.time>n.value[t].lastRead),e}),m=F([]),y={root:null,rootMargin:"0px",threshold:0},g=new IntersectionObserver(N,y);D(()=>{m.value=m.value.map(e=>e.children[0].children[0].children[1].children[1]),m.value=m.value.filter(e=>e.getAttribute("time")),m.value.forEach(e=>{console.log(e),g.observe(e)})});function b(e){return f.user.uid==e?"right":"left"}function N(e){e.forEach(d=>{if(console.log("entry"),d.isIntersecting){const w=d.target.getAttribute("time");console.log("read"),w>n.value[t].lastRead&&(console.log("Sending Read Reciept"),f.sendReciept(_._id,{lastRead:w}))}})}return(e,d)=>(s(),r("div",P,[(s(!0),r(T,null,B(a(c),(w,p)=>(s(),r(T,{key:p},[p=="unread"?(s(),r("div",Q,X)):k("",!0),$(" "+x(p)+" ",1),(s(!0),r(T,null,B(a(c)[p],(o,R)=>(s(),r("div",{key:R,ref_for:!0,ref:p,class:"grid mx-2 my-4"},[l("div",{class:U(["bubble shadow-sm",{left:b(o.sender)=="left",right:b(o.sender)=="right"}])},[l("div",null,[l("div",null,x(o.text),1),l("div",Y,[l("div",Z,x(a(f).formatTimeDisplay(o.time)),1),b(o.sender)=="right"?(s(),r("div",ee,[n.value[a(L)].lastRead>=o.time?(s(),r("svg",te,oe)):n.value[a(t)].lastDelivered>o.time?(s(),r("svg",se,re)):n.value[a(t)].lastSent>o.time?(s(),r("svg",ie,ce)):n.value[a(t)].lastSent<o.time?(s(),r("svg",de,_e)):k("",!0)])):k("",!0),b(o.sender)=="left"?(s(),r("div",{key:1,time:o.time},null,8,me)):k("",!0)])])],2)]))),128))],64))),128))]))}},ve=A(pe,[["__scopeId","data-v-253d7a4b"]]),he={class:"text-xs"},we={__name:"Chat",setup(h){const f=I(),_=J();let t=F(!1);const L=_.query.origin;let n;switch(L){case"/home":n="recent";break;case"/chats":n="chats";break}let c=E(f[n].find(y=>y.profile.username==_.params.username));const m=E({type:"Chat",chatid:c._id||c.chatid});return(y,g)=>{const b=u("v-navigation-drawer"),N=u("v-app-bar-nav-icon"),e=u("v-img"),d=u("v-avatar"),w=u("v-app-bar-title"),p=u("v-app-bar"),o=u("v-container"),R=u("v-main"),z=u("v-app");return s(),H(z,null,{default:v(()=>[i(b,{modelValue:a(t),"onUpdate:modelValue":g[0]||(g[0]=M=>V(t)?t.value=M:t=M)},{default:v(()=>[i(O)]),_:1},8,["modelValue"]),i(p,{elevation:2,color:"red-darken-1"},{default:v(()=>[i(N,{onClick:g[1]||(g[1]=M=>V(t)?t.value=!a(t):t=!a(t))}),i(d,null,{default:v(()=>[i(e,{alt:"John",src:a(c).profile.photoURL},null,8,["src"])]),_:1}),i(w,null,{default:v(()=>[l("span",null,x(a(c).profile.displayName),1),l("span",he," @"+x(a(c).profile.username),1)]),_:1})]),_:1}),i(R,null,{default:v(()=>[i(o,{class:"ma-0 pa-0 mx-auto flex flex-col justify-between h-full"},{default:v(()=>[i(ve,{chat:a(c)},null,8,["chat"]),i(K,{to:m},null,8,["to"])]),_:1})]),_:1})]),_:1})}}};export{we as default};
