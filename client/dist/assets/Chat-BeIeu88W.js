import{_ as H}from"./SideBar-7GHzDIG_.js";import{u as I,r as C,x as T,o as V,c as n,j as c,F as N,y as S,g as t,k as L,h as i,t as B,C as j,G as O,s as G,v as W,a as z,f as o,E as q,b as _,d as J,w as f,p as K,m as $}from"./index-Br-JaDgN.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as P}from"./Messenger-cZzO8Jrd.js";const M=p=>(G("data-v-b40407ce"),p=p(),W(),p),Q={key:0,id:"unread-tag",class:"text-center"},X=M(()=>i("span",{class:"text-xl underline"},"Unread Messages",-1)),Y=[X],Z={class:"flex flex-row gap-1 float-right text-xs"},ee={id:"time"},te={key:0,id:"reciept",class:"grid items-center"},ae={key:0,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},se=M(()=>i("path",{fill:"currentColor",stroke:"#43A047",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),ne=[se],oe={key:1,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},ie=M(()=>i("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),re=[ie],le={key:2,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},ce=M(()=>i("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M21 7L9 19l-5.5-5.5l1.41-1.41L9 16.17L19.59 5.59z"},null,-1)),de=[ce],ue={key:3,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},me=O('<circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-b40407ce><animateTransform attributeName="transform" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="0 12 12;90 12 12;180 12 12;270 12 12" data-v-b40407ce></animateTransform><animate attributeName="opacity" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-b40407ce></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-b40407ce><animateTransform attributeName="transform" begin="0.2s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="30 12 12;120 12 12;210 12 12;300 12 12" data-v-b40407ce></animateTransform><animate attributeName="opacity" begin="0.2s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-b40407ce></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-b40407ce><animateTransform attributeName="transform" begin="0.4s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="60 12 12;150 12 12;240 12 12;330 12 12" data-v-b40407ce></animateTransform><animate attributeName="opacity" begin="0.4s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-b40407ce></animate></circle>',3),_e=[me],ve=["time"],pe={__name:"Bubbles",props:["chat"],setup(p,{expose:w}){const v=I(),{chat:d}=p,r=C(null);w({bubbleDiv:r});const u=v.user.uid,a=d._id.split(u).find(s=>s.length>0);let k;const l=T(()=>d.meta);let h=T(()=>{let s={};return s.read=d.messages.filter(m=>m.time<l.value[u].lastRead),s.unread=d.messages.filter(m=>m.time>l.value[u].lastRead),s});function R(){let m={root:null,rootMargin:`0px 0px -${r.value.parentElement.children[1].offsetHeight}px 0px`,threshold:0};k=new IntersectionObserver(D,m);let b=[],g=r.value.children;for(let e of g){const x=e.children[0].children[0].children[1].children[1];x.getAttribute("time")&&b.push(x)}b.forEach(e=>{e.getAttribute("time")>l.value[u].lastRead&&k.observe(e)})}V(()=>{new MutationObserver(()=>R()).observe(r.value,{childList:!0})});function y(s){return v.user.uid==s?"right":"left"}function D(s){s.forEach(m=>{if(m.isIntersecting){const b=m.target.getAttribute("time");b>l.value[u].lastRead&&(console.log("Sending Read Reciept"),v.sendReciept(d._id,{lastRead:b}),k.unobserve(m.target))}})}return(s,m)=>(n(),c("div",{id:"bubbleDiv",ref_key:"bubbleDiv",ref:r},[(n(!0),c(N,null,S(t(h),(b,g)=>(n(),c(N,{key:g},[g=="unread"&&t(h).length>0?(n(),c("div",Q,Y)):L("",!0),(n(!0),c(N,null,S(t(h)[g],(e,x)=>(n(),c("div",{key:x,ref_for:!0,ref:g,class:"grid mx-2 my-4"},[i("div",{class:j(["bubble shadow-sm",{left:y(e.sender)=="left",right:y(e.sender)=="right"}])},[i("div",null,[i("div",null,B(e.text),1),i("div",Z,[i("div",ee,B(t(v).formatTimeDisplay(e.time)),1),y(e.sender)=="right"?(n(),c("div",te,[l.value[t(a)].lastRead>=e.time?(n(),c("svg",ae,ne)):l.value[t(a)].lastDelivered>e.time?(n(),c("svg",oe,re)):l.value[t(u)].lastSent>e.time?(n(),c("svg",le,de)):l.value[t(u)].lastSent<e.time?(n(),c("svg",ue,_e)):L("",!0)])):L("",!0),y(e.sender)=="left"?(n(),c("div",{key:1,time:e.time},null,8,ve)):L("",!0)])])],2)]))),128))],64))),128))],512))}},fe=F(pe,[["__scopeId","data-v-b40407ce"]]),he={__name:"Chat",props:["active","to"],setup(p){const w=C(null),v=C(null),d=C(null);function r(){const u=d.value.widgetDiv.offsetHeight,a=w.value.offsetWidth;v.value.bubbleDiv.style.width=a+"px",v.value.bubbleDiv.style.marginBottom=u+"px",d.value.widgetDiv.style.margin="auto",d.value.widgetDiv.style.width=a+"px"}return V(()=>{r(),window.addEventListener("resize",r)}),z(()=>window.removeEventListener("resize",r)),(u,a)=>(n(),c("div",{class:"flex flex-col h-full",ref_key:"page",ref:w},[o(fe,{chat:p.active,class:"w-full text-sm",ref_key:"chat",ref:v},null,8,["chat"]),o(P,{class:"messenger w-full",to:p.to,ref_key:"widget",ref:d},null,8,["to"])],512))}},be=F(he,[["__scopeId","data-v-6f5585ab"]]),ge=i("br",null,null,-1),we={class:"text-xs"},Le={__name:"Chat",setup(p){const w=C(!1),{back:v}=$("app"),d=$("theme"),r=I(),u=K();let a=r.chats.find(l=>l.profile.username==u.params.username);const k=q({type:"Chat",chatid:a._id});return z(()=>{r.chats=r.chats.filter(l=>l.messages.length>0)}),(l,h)=>{const R=_("v-navigation-drawer"),y=_("v-icon"),D=_("v-app-bar-nav-icon"),s=_("v-img"),m=_("v-avatar"),b=_("router-link"),g=_("v-app-bar-title"),e=_("v-app-bar"),x=_("v-container"),A=_("v-main"),U=_("v-app");return n(),J(U,null,{default:f(()=>[o(R,{modelValue:w.value,"onUpdate:modelValue":h[0]||(h[0]=E=>w.value=E)},{default:f(()=>[o(H)]),_:1},8,["modelValue"]),o(e,{elevation:2,color:t(d).base},{default:f(()=>[o(D,{onClick:h[1]||(h[1]=E=>t(v)())},{default:f(()=>[o(y,{icon:"mdi-keyboard-backspace"})]),_:1}),o(m,null,{default:f(()=>[o(s,{alt:t(a).profile.displayName,src:t(a).profile.photoURL},null,8,["alt","src"])]),_:1}),o(g,null,{default:f(()=>[o(b,{to:"../"+t(a).profile.username},{default:f(()=>[i("div",null,[i("p",null,[i("span",null,B(t(a).profile.displayName),1),ge,i("span",we,"@"+B(t(a).profile.username),1)])])]),_:1},8,["to"])]),_:1})]),_:1},8,["color"]),o(A,null,{default:f(()=>[o(x,{class:"ma-0 pa-0 mx-auto h-full"},{default:f(()=>[o(be,{active:t(a),to:k},null,8,["active","to"])]),_:1})]),_:1})]),_:1})}}};export{Le as default};
