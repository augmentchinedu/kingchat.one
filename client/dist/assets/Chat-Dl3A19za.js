import{_ as U}from"./SideBar-DVnO571h.js";import{u as I,r as L,l as E,I as $,o as s,f as r,F as D,m as S,d as n,g as R,e as i,t as B,q as H,J as j,p as q,k as O,n as V,b as l,x as J,c as W,w as y,h as G,a as f,s as K,j as P}from"./index-DNYi1HWJ.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Q}from"./Messenger-BIL9EpGO.js";const M=h=>(q("data-v-b40407ce"),h=h(),O(),h),X={key:0,id:"unread-tag",class:"text-center"},Y=M(()=>i("span",{class:"text-xl underline"},"Unread Messages",-1)),Z=[Y],ee={class:"flex flex-row gap-1 float-right text-xs"},te={id:"time"},ae={key:0,id:"reciept",class:"grid items-center"},se={key:0,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},ne=M(()=>i("path",{fill:"currentColor",stroke:"#43A047",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),ie=[ne],oe={key:1,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},re=M(()=>i("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),le=[re],ce={key:2,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},de=M(()=>i("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M21 7L9 19l-5.5-5.5l1.41-1.41L9 16.17L19.59 5.59z"},null,-1)),ue=[de],me={key:3,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},_e=j('<circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-b40407ce><animateTransform attributeName="transform" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="0 12 12;90 12 12;180 12 12;270 12 12" data-v-b40407ce></animateTransform><animate attributeName="opacity" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-b40407ce></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-b40407ce><animateTransform attributeName="transform" begin="0.2s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="30 12 12;120 12 12;210 12 12;300 12 12" data-v-b40407ce></animateTransform><animate attributeName="opacity" begin="0.2s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-b40407ce></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-b40407ce><animateTransform attributeName="transform" begin="0.4s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="60 12 12;150 12 12;240 12 12;330 12 12" data-v-b40407ce></animateTransform><animate attributeName="opacity" begin="0.4s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-b40407ce></animate></circle>',3),ve=[_e],pe=["time"],fe={__name:"Bubbles",props:["chat"],setup(h,{expose:k}){const m=I(),{chat:t}=h,o=L(null);k({bubbleDiv:o});const c=m.user.uid,_=t._id.split(c).find(a=>a.length>0);let d;const v=E(()=>t.meta);let p=E(()=>{let a={};return a.read=t.messages.filter(u=>u.time<v.value[c].lastRead),a.unread=t.messages.filter(u=>u.time>v.value[c].lastRead),a});function b(){let u={root:null,rootMargin:`0px 0px -${o.value.parentElement.children[1].offsetHeight}px 0px`,threshold:0};d=new IntersectionObserver(N,u);let w=[],x=o.value.children;for(let e of x){const C=e.children[0].children[0].children[1].children[1];C.getAttribute("time")&&w.push(C)}w.forEach(e=>{e.getAttribute("time")>v.value[c].lastRead&&d.observe(e)})}$(()=>{new MutationObserver(()=>b()).observe(o.value,{childList:!0})});function g(a){return m.user.uid==a?"right":"left"}function N(a){a.forEach(u=>{if(u.isIntersecting){const w=u.target.getAttribute("time");w>v.value[c].lastRead&&(console.log("Sending Read Reciept"),m.sendReciept(t._id,{lastRead:w}),d.unobserve(u.target))}})}return(a,u)=>(s(),r("div",{id:"bubbleDiv",ref_key:"bubbleDiv",ref:o},[(s(!0),r(D,null,S(n(p),(w,x)=>(s(),r(D,{key:x},[x=="unread"&&n(p).length>0?(s(),r("div",X,Z)):R("",!0),(s(!0),r(D,null,S(n(p)[x],(e,C)=>(s(),r("div",{key:C,ref_for:!0,ref:x,class:"grid mx-2 my-4"},[i("div",{class:H(["bubble shadow-sm",{left:g(e.sender)=="left",right:g(e.sender)=="right"}])},[i("div",null,[i("div",null,B(e.text),1),i("div",ee,[i("div",te,B(n(m).formatTimeDisplay(e.time)),1),g(e.sender)=="right"?(s(),r("div",ae,[v.value[n(_)].lastRead>=e.time?(s(),r("svg",se,ie)):v.value[n(_)].lastDelivered>e.time?(s(),r("svg",oe,le)):v.value[n(c)].lastSent>e.time?(s(),r("svg",ce,ue)):v.value[n(c)].lastSent<e.time?(s(),r("svg",me,ve)):R("",!0)])):R("",!0),g(e.sender)=="left"?(s(),r("div",{key:1,time:e.time},null,8,pe)):R("",!0)])])],2)]))),128))],64))),128))],512))}},he=z(fe,[["__scopeId","data-v-b40407ce"]]),be={__name:"Chat",props:["active","to"],setup(h){const k=L(null),m=L(null),t=L(null);function o(){const c=t.value.widgetDiv.offsetHeight,_=k.value.offsetWidth;m.value.bubbleDiv.style.width=_+"px",m.value.bubbleDiv.style.marginBottom=c+"px",t.value.widgetDiv.style.margin="auto",t.value.widgetDiv.style.width=_+"px"}return $(()=>{o(),window.addEventListener("resize",o)}),V(()=>window.removeEventListener("resize",o)),(c,_)=>(s(),r("div",{class:"flex flex-col h-full",ref_key:"page",ref:k},[l(he,{chat:h.active,class:"w-full text-sm",ref_key:"chat",ref:m},null,8,["chat"]),l(Q,{class:"messenger w-full",to:h.to,ref_key:"widget",ref:t},null,8,["to"])],512))}},ge=z(be,[["__scopeId","data-v-6f5585ab"]]),we=i("br",null,null,-1),xe={class:"text-xs"},Re={__name:"Chat",setup(h){const k=L(!1),{back:m}=K("app"),t=I(),o=G();P();const c=o.query.origin;let _;switch(c){case"/home":_="recent";break;case"/chats":_="chats";break}let d=t.chats.find(p=>p.profile.username==o.params.username);if(!d){let{_id:p,profile:b}=t[_].find(g=>g.profile.username==o.params.username);d=t.createNewChat(p,b)}const v=J({type:"Chat",chatid:d._id});return V(()=>{t.chats=t.chats.filter(p=>p.messages.length>0)}),(p,b)=>{const g=f("v-navigation-drawer"),N=f("v-icon"),a=f("v-app-bar-nav-icon"),u=f("v-img"),w=f("v-avatar"),x=f("v-app-bar-title"),e=f("v-app-bar"),C=f("v-container"),F=f("v-main"),A=f("v-app");return s(),W(A,null,{default:y(()=>[l(g,{modelValue:k.value,"onUpdate:modelValue":b[0]||(b[0]=T=>k.value=T)},{default:y(()=>[l(U)]),_:1},8,["modelValue"]),l(e,{elevation:2,color:"red-darken-1"},{default:y(()=>[l(a,{onClick:b[1]||(b[1]=T=>n(m)())},{default:y(()=>[l(N,{icon:"mdi-keyboard-backspace"})]),_:1}),l(w,null,{default:y(()=>[l(u,{alt:n(d).profile.displayName,src:n(d).profile.photoURL},null,8,["alt","src"])]),_:1}),l(x,null,{default:y(()=>[i("div",null,[i("p",null,[i("span",null,B(n(d).profile.displayName),1),we,i("span",xe,"@"+B(n(d).profile.username),1)])])]),_:1})]),_:1}),l(F,null,{default:y(()=>[l(C,{class:"ma-0 pa-0 mx-auto h-full"},{default:y(()=>[l(ge,{active:n(d),to:v},null,8,["active","to"])]),_:1})]),_:1})]),_:1})}}};export{Re as default};
