import{_ as H}from"./SideBar-C0sOHVo_.js";import{u as $,r as L,l as E,x as z,o as n,f as c,F as D,m as S,d as a,g as R,e as i,t as B,q as j,z as q,p as O,k as W,n as I,b as o,A as G,c as J,w as b,h as K,a as m,s as P,j as Q}from"./index-dgr1qsgB.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as X}from"./Messenger-E0LclfP5.js";const M=h=>(O("data-v-b40407ce"),h=h(),W(),h),Y={key:0,id:"unread-tag",class:"text-center"},Z=M(()=>i("span",{class:"text-xl underline"},"Unread Messages",-1)),ee=[Z],te={class:"flex flex-row gap-1 float-right text-xs"},ae={id:"time"},se={key:0,id:"reciept",class:"grid items-center"},ne={key:0,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},oe=M(()=>i("path",{fill:"currentColor",stroke:"#43A047",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),ie=[oe],re={key:1,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},le=M(()=>i("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),ce=[le],de={key:2,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},ue=M(()=>i("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M21 7L9 19l-5.5-5.5l1.41-1.41L9 16.17L19.59 5.59z"},null,-1)),me=[ue],_e={key:3,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},ve=q('<circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-b40407ce><animateTransform attributeName="transform" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="0 12 12;90 12 12;180 12 12;270 12 12" data-v-b40407ce></animateTransform><animate attributeName="opacity" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-b40407ce></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-b40407ce><animateTransform attributeName="transform" begin="0.2s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="30 12 12;120 12 12;210 12 12;300 12 12" data-v-b40407ce></animateTransform><animate attributeName="opacity" begin="0.2s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-b40407ce></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-b40407ce><animateTransform attributeName="transform" begin="0.4s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="60 12 12;150 12 12;240 12 12;330 12 12" data-v-b40407ce></animateTransform><animate attributeName="opacity" begin="0.4s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-b40407ce></animate></circle>',3),pe=[ve],fe=["time"],he={__name:"Bubbles",props:["chat"],setup(h,{expose:k}){const _=$(),{chat:t}=h,r=L(null);k({bubbleDiv:r});const d=_.user.uid,v=t._id.split(d).find(s=>s.length>0);let l;const p=E(()=>t.meta);let f=E(()=>{let s={};return s.read=t.messages.filter(u=>u.time<p.value[d].lastRead),s.unread=t.messages.filter(u=>u.time>p.value[d].lastRead),s});function g(){let u={root:null,rootMargin:`0px 0px -${r.value.parentElement.children[1].offsetHeight}px 0px`,threshold:0};l=new IntersectionObserver(N,u);let x=[],y=r.value.children;for(let e of y){const C=e.children[0].children[0].children[1].children[1];C.getAttribute("time")&&x.push(C)}x.forEach(e=>{e.getAttribute("time")>p.value[d].lastRead&&l.observe(e)})}z(()=>{new MutationObserver(()=>g()).observe(r.value,{childList:!0})});function w(s){return _.user.uid==s?"right":"left"}function N(s){s.forEach(u=>{if(u.isIntersecting){const x=u.target.getAttribute("time");x>p.value[d].lastRead&&(console.log("Sending Read Reciept"),_.sendReciept(t._id,{lastRead:x}),l.unobserve(u.target))}})}return(s,u)=>(n(),c("div",{id:"bubbleDiv",ref_key:"bubbleDiv",ref:r},[(n(!0),c(D,null,S(a(f),(x,y)=>(n(),c(D,{key:y},[y=="unread"&&a(f).length>0?(n(),c("div",Y,ee)):R("",!0),(n(!0),c(D,null,S(a(f)[y],(e,C)=>(n(),c("div",{key:C,ref_for:!0,ref:y,class:"grid mx-2 my-4"},[i("div",{class:j(["bubble shadow-sm",{left:w(e.sender)=="left",right:w(e.sender)=="right"}])},[i("div",null,[i("div",null,B(e.text),1),i("div",te,[i("div",ae,B(a(_).formatTimeDisplay(e.time)),1),w(e.sender)=="right"?(n(),c("div",se,[p.value[a(v)].lastRead>=e.time?(n(),c("svg",ne,ie)):p.value[a(v)].lastDelivered>e.time?(n(),c("svg",re,ce)):p.value[a(d)].lastSent>e.time?(n(),c("svg",de,me)):p.value[a(d)].lastSent<e.time?(n(),c("svg",_e,pe)):R("",!0)])):R("",!0),w(e.sender)=="left"?(n(),c("div",{key:1,time:e.time},null,8,fe)):R("",!0)])])],2)]))),128))],64))),128))],512))}},be=V(he,[["__scopeId","data-v-b40407ce"]]),ge={__name:"Chat",props:["active","to"],setup(h){const k=L(null),_=L(null),t=L(null);function r(){const d=t.value.widgetDiv.offsetHeight,v=k.value.offsetWidth;_.value.bubbleDiv.style.width=v+"px",_.value.bubbleDiv.style.marginBottom=d+"px",t.value.widgetDiv.style.margin="auto",t.value.widgetDiv.style.width=v+"px"}return z(()=>{r(),window.addEventListener("resize",r)}),I(()=>window.removeEventListener("resize",r)),(d,v)=>(n(),c("div",{class:"flex flex-col h-full",ref_key:"page",ref:k},[o(be,{chat:h.active,class:"w-full text-sm",ref_key:"chat",ref:_},null,8,["chat"]),o(X,{class:"messenger w-full",to:h.to,ref_key:"widget",ref:t},null,8,["to"])],512))}},we=V(ge,[["__scopeId","data-v-6f5585ab"]]),xe=i("br",null,null,-1),ye={class:"text-xs"},Be={__name:"Chat",setup(h){const k=L(!1),{back:_}=P("app"),t=$(),r=K();Q();const d=r.query.origin;let v;switch(d){case"/home":v="recent";break;case"/chats":v="chats";break}let l=t.chats.find(f=>f.profile.username==r.params.username);if(!l){let{_id:f,profile:g}=t[v].find(w=>w.profile.username==r.params.username);l=t.createNewChat(f,g)}const p=G({type:"Chat",chatid:l._id});return I(()=>{t.chats=t.chats.filter(f=>f.messages.length>0)}),(f,g)=>{const w=m("v-navigation-drawer"),N=m("v-icon"),s=m("v-app-bar-nav-icon"),u=m("v-img"),x=m("v-avatar"),y=m("router-link"),e=m("v-app-bar-title"),C=m("v-app-bar"),A=m("v-container"),F=m("v-main"),U=m("v-app");return n(),J(U,null,{default:b(()=>[o(w,{modelValue:k.value,"onUpdate:modelValue":g[0]||(g[0]=T=>k.value=T)},{default:b(()=>[o(H)]),_:1},8,["modelValue"]),o(C,{elevation:2,color:"red-darken-1"},{default:b(()=>[o(s,{onClick:g[1]||(g[1]=T=>a(_)())},{default:b(()=>[o(N,{icon:"mdi-keyboard-backspace"})]),_:1}),o(x,null,{default:b(()=>[o(u,{alt:a(l).profile.displayName,src:a(l).profile.photoURL},null,8,["alt","src"])]),_:1}),o(e,null,{default:b(()=>[o(y,{to:"../"+a(l).profile.username},{default:b(()=>[i("div",null,[i("p",null,[i("span",null,B(a(l).profile.displayName),1),xe,i("span",ye,"@"+B(a(l).profile.username),1)])])]),_:1},8,["to"])]),_:1})]),_:1}),o(F,null,{default:b(()=>[o(A,{class:"ma-0 pa-0 mx-auto h-full"},{default:b(()=>[o(we,{active:a(l),to:p},null,8,["active","to"])]),_:1})]),_:1})]),_:1})}}};export{Be as default};
