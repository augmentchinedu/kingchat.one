import{_ as F}from"./SideBar-BjtcfIGG.js";import{_ as V,f as $,r as C,g as T,D as z,o,h as r,F as N,j as S,u as l,E as L,d as u,t as B,G as A,H,p as U,n as O,I as j,b as c,k as I,c as q,w as x,e as G,a as f}from"./index-y68AKlvE.js";import{_ as W}from"./Messenger-F0zaR1Hb.js";const D=_=>(U("data-v-9e28d920"),_=_(),O(),_),J={key:0,id:"unread-tag",class:"text-center"},K=D(()=>u("span",{class:"text-xl underline"},"Unread Messages",-1)),P=[K],Q={class:"flex flex-row gap-1 float-right text-xs"},X={id:"time"},Y={key:0,id:"reciept",class:"grid items-center"},Z={key:0,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},ee=D(()=>u("path",{fill:"currentColor",stroke:"#43A047",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),te=[ee],ae={key:1,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},se=D(()=>u("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),oe=[se],ne={key:2,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},ie=D(()=>u("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M21 7L9 19l-5.5-5.5l1.41-1.41L9 16.17L19.59 5.59z"},null,-1)),re=[ie],le={key:3,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},ce=H('<circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-9e28d920><animateTransform attributeName="transform" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="0 12 12;90 12 12;180 12 12;270 12 12" data-v-9e28d920></animateTransform><animate attributeName="opacity" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-9e28d920></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-9e28d920><animateTransform attributeName="transform" begin="0.2s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="30 12 12;120 12 12;210 12 12;300 12 12" data-v-9e28d920></animateTransform><animate attributeName="opacity" begin="0.2s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-9e28d920></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-9e28d920><animateTransform attributeName="transform" begin="0.4s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="60 12 12;150 12 12;240 12 12;330 12 12" data-v-9e28d920></animateTransform><animate attributeName="opacity" begin="0.4s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-9e28d920></animate></circle>',3),de=[ce],ue=["time"],me={__name:"Bubbles",props:["chat"],setup(_,{expose:p}){const m=$(),{chat:n}=_,v=C(null);p({bubbleDiv:v});const s=m.user.uid,t=n._id.split(s).find(a=>a.length>0);let k;const d=T(()=>n.meta);let h=T(()=>{let a={};return a.read=n.messages.filter(i=>i.time<d.value[s].lastRead),a.unread=n.messages.filter(i=>i.time>d.value[s].lastRead),console.log(a.unread),a});function M(){let i={root:null,rootMargin:`0px 0px -${v.value.parentElement.children[1].offsetHeight}px 0px`,threshold:0};k=new IntersectionObserver(R,i);let g=[],b=v.value.children;for(let e of b){const w=e.children[0].children[0].children[1].children[1];w.getAttribute("time")&&g.push(w)}g.forEach(e=>{e.getAttribute("time")>d.value[s].lastRead&&(console.log(e),k.observe(e))})}z(()=>{new MutationObserver(()=>M()).observe(v.value,{childList:!0})});function y(a){return m.user.uid==a?"right":"left"}function R(a){a.forEach(i=>{if(console.log(i),i.isIntersecting){const g=i.target.getAttribute("time");console.log("read"),g>d.value[s].lastRead&&(console.log("Sending Read Reciept"),m.sendReciept(n._id,{lastRead:g}),k.unobserve(i.target))}})}return(a,i)=>(o(),r("div",{id:"bubbleDiv",ref_key:"bubbleDiv",ref:v},[(o(!0),r(N,null,S(l(h),(g,b)=>(o(),r(N,{key:b},[b=="unread"&&l(h).length>0?(o(),r("div",J,P)):L("",!0),(o(!0),r(N,null,S(l(h)[b],(e,w)=>(o(),r("div",{key:w,ref_for:!0,ref:b,class:"grid mx-2 my-4"},[u("div",{class:A(["bubble shadow-sm",{left:y(e.sender)=="left",right:y(e.sender)=="right"}])},[u("div",null,[u("div",null,B(e.text),1),u("div",Q,[u("div",X,B(l(m).formatTimeDisplay(e.time)),1),y(e.sender)=="right"?(o(),r("div",Y,[d.value[l(t)].lastRead>=e.time?(o(),r("svg",Z,te)):d.value[l(t)].lastDelivered>e.time?(o(),r("svg",ae,oe)):d.value[l(s)].lastSent>e.time?(o(),r("svg",ne,re)):d.value[l(s)].lastSent<e.time?(o(),r("svg",le,de)):L("",!0)])):L("",!0),y(e.sender)=="left"?(o(),r("div",{key:1,time:e.time},null,8,ue)):L("",!0)])])],2)]))),128))],64))),128))],512))}},ve=V(me,[["__scopeId","data-v-9e28d920"]]),_e={__name:"Chat",props:["active","to"],setup(_){const p=C(null),m=C(null),n=C(null);function v(){const s=n.value.widgetDiv.offsetHeight,t=p.value.offsetWidth;m.value.bubbleDiv.style.width=t+"px",m.value.bubbleDiv.style.marginBottom=s+"px",n.value.widgetDiv.style.margin="auto",n.value.widgetDiv.style.width=t+"px"}return z(()=>{v(),window.addEventListener("resize",v)}),j(()=>window.removeEventListener("resize")),(s,t)=>(o(),r("div",{class:"flex flex-col h-full",ref_key:"page",ref:p},[c(ve,{chat:_.active,class:"w-full text-sm",ref_key:"chat",ref:m},null,8,["chat"]),c(W,{class:"messenger w-full",to:_.to,ref_key:"widget",ref:n},null,8,["to"])],512))}},pe=V(_e,[["__scopeId","data-v-496a0867"]]),fe={class:"text-xs"},we={__name:"Chat",setup(_){const p=C(!1),m=$(),n=G(),v=n.query.origin;let s;switch(v){case"/home":s="recent";break;case"/chats":s="chats";break}let t=I(m[s].find(d=>d.profile.username==n.params.username));const k=I({type:"Chat",chatid:t._id||t.chatid});return console.log(t),(d,h)=>{const M=f("v-navigation-drawer"),y=f("v-app-bar-nav-icon"),R=f("v-img"),a=f("v-avatar"),i=f("v-app-bar-title"),g=f("v-app-bar"),b=f("v-container"),e=f("v-main"),w=f("v-app");return o(),q(w,null,{default:x(()=>[c(M,{modelValue:p.value,"onUpdate:modelValue":h[0]||(h[0]=E=>p.value=E)},{default:x(()=>[c(F)]),_:1},8,["modelValue"]),c(g,{elevation:2,color:"red-darken-1"},{default:x(()=>[c(y,{onClick:h[1]||(h[1]=E=>p.value=!p.value)}),c(a,null,{default:x(()=>[c(R,{alt:l(t).profile.displayName,src:l(t).profile.photoURL},null,8,["alt","src"])]),_:1}),c(i,null,{default:x(()=>[u("span",null,B(l(t).profile.displayName),1),u("span",fe," @"+B(l(t).profile.username),1)]),_:1})]),_:1}),c(e,null,{default:x(()=>[c(b,{class:"ma-0 pa-0 mx-auto h-full"},{default:x(()=>[c(pe,{active:l(t),to:k},null,8,["active","to"])]),_:1})]),_:1})]),_:1})}}};export{we as default};
