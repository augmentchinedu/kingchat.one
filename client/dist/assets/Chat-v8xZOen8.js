import{_ as A}from"./SideBar-ePkoO1US.js";import{u as $,r as C,v as T,o as z,c as o,j as c,F as N,x as S,g as a,k as L,h as r,t as B,C as U,G as H,q as j,s as O,a as I,f as i,E as q,b as m,d as G,w as p,m as W,z as J}from"./index-Bz6dU154.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as K}from"./Messenger-BpkY1S9V.js";const M=v=>(j("data-v-b40407ce"),v=v(),O(),v),P={key:0,id:"unread-tag",class:"text-center"},Q=M(()=>r("span",{class:"text-xl underline"},"Unread Messages",-1)),X=[Q],Y={class:"flex flex-row gap-1 float-right text-xs"},Z={id:"time"},ee={key:0,id:"reciept",class:"grid items-center"},te={key:0,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},ae=M(()=>r("path",{fill:"currentColor",stroke:"#43A047",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),ne=[ae],se={key:1,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},oe=M(()=>r("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),ie=[oe],re={key:2,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},le=M(()=>r("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M21 7L9 19l-5.5-5.5l1.41-1.41L9 16.17L19.59 5.59z"},null,-1)),ce=[le],de={key:3,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},ue=H('<circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-b40407ce><animateTransform attributeName="transform" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="0 12 12;90 12 12;180 12 12;270 12 12" data-v-b40407ce></animateTransform><animate attributeName="opacity" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-b40407ce></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-b40407ce><animateTransform attributeName="transform" begin="0.2s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="30 12 12;120 12 12;210 12 12;300 12 12" data-v-b40407ce></animateTransform><animate attributeName="opacity" begin="0.2s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-b40407ce></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-b40407ce><animateTransform attributeName="transform" begin="0.4s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="60 12 12;150 12 12;240 12 12;330 12 12" data-v-b40407ce></animateTransform><animate attributeName="opacity" begin="0.4s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-b40407ce></animate></circle>',3),me=[ue],_e=["time"],ve={__name:"Bubbles",props:["chat"],setup(v,{expose:w}){const _=$(),{chat:n}=v,u=C(null);w({bubbleDiv:u});const e=_.user.uid,f=n._id.split(e).find(s=>s.length>0);let h;const l=T(()=>n.meta);let k=T(()=>{let s={};return s.read=n.messages.filter(d=>d.time<l.value[e].lastRead),s.unread=n.messages.filter(d=>d.time>l.value[e].lastRead),s});function R(){let d={root:null,rootMargin:`0px 0px -${u.value.parentElement.children[1].offsetHeight}px 0px`,threshold:0};h=new IntersectionObserver(D,d);let b=[],g=u.value.children;for(let t of g){const x=t.children[0].children[0].children[1].children[1];x.getAttribute("time")&&b.push(x)}b.forEach(t=>{t.getAttribute("time")>l.value[e].lastRead&&h.observe(t)})}z(()=>{new MutationObserver(()=>R()).observe(u.value,{childList:!0})});function y(s){return _.user.uid==s?"right":"left"}function D(s){s.forEach(d=>{if(d.isIntersecting){const b=d.target.getAttribute("time");b>l.value[e].lastRead&&(console.log("Sending Read Reciept"),_.sendReciept(n._id,{lastRead:b}),h.unobserve(d.target))}})}return(s,d)=>(o(),c("div",{id:"bubbleDiv",ref_key:"bubbleDiv",ref:u},[(o(!0),c(N,null,S(a(k),(b,g)=>(o(),c(N,{key:g},[g=="unread"&&a(k).length>0?(o(),c("div",P,X)):L("",!0),(o(!0),c(N,null,S(a(k)[g],(t,x)=>(o(),c("div",{key:x,ref_for:!0,ref:g,class:"grid mx-2 my-4"},[r("div",{class:U(["bubble shadow-sm",{left:y(t.sender)=="left",right:y(t.sender)=="right"}])},[r("div",null,[r("div",null,B(t.text),1),r("div",Y,[r("div",Z,B(a(_).formatTimeDisplay(t.time)),1),y(t.sender)=="right"?(o(),c("div",ee,[l.value[a(f)].lastRead>=t.time?(o(),c("svg",te,ne)):l.value[a(f)].lastDelivered>t.time?(o(),c("svg",se,ie)):l.value[a(e)].lastSent>t.time?(o(),c("svg",re,ce)):l.value[a(e)].lastSent<t.time?(o(),c("svg",de,me)):L("",!0)])):L("",!0),y(t.sender)=="left"?(o(),c("div",{key:1,time:t.time},null,8,_e)):L("",!0)])])],2)]))),128))],64))),128))],512))}},pe=V(ve,[["__scopeId","data-v-b40407ce"]]),fe={__name:"Chat",props:["active","to"],setup(v){const w=C(null),_=C(null),n=C(null);function u(){const e=n.value.widgetDiv.offsetHeight,f=w.value.offsetWidth;_.value.bubbleDiv.style.width=f+"px",_.value.bubbleDiv.style.marginBottom=e+"px",n.value.widgetDiv.style.margin="auto",n.value.widgetDiv.style.width=f+"px"}return z(()=>{u(),window.addEventListener("resize",u)}),I(()=>window.removeEventListener("resize",u)),(e,f)=>(o(),c("div",{class:"flex flex-col h-full",ref_key:"page",ref:w},[i(pe,{chat:v.active,class:"w-full text-sm",ref_key:"chat",ref:_},null,8,["chat"]),i(K,{class:"messenger w-full",to:v.to,ref_key:"widget",ref:n},null,8,["to"])],512))}},he=V(fe,[["__scopeId","data-v-6f5585ab"]]),be=r("br",null,null,-1),ge={class:"text-xs"},Ce={__name:"Chat",setup(v){const w=C(!1),{back:_}=J("app"),n=$(),u=W();let e=n.chats.find(h=>h.profile.username==u.params.username);const f=q({type:"Chat",chatid:e._id});return I(()=>{n.chats=n.chats.filter(h=>h.messages.length>0)}),(h,l)=>{const k=m("v-navigation-drawer"),R=m("v-icon"),y=m("v-app-bar-nav-icon"),D=m("v-img"),s=m("v-avatar"),d=m("router-link"),b=m("v-app-bar-title"),g=m("v-app-bar"),t=m("v-container"),x=m("v-main"),F=m("v-app");return o(),G(F,null,{default:p(()=>[i(k,{modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=E=>w.value=E)},{default:p(()=>[i(A)]),_:1},8,["modelValue"]),i(g,{elevation:2,color:"red-darken-1"},{default:p(()=>[i(y,{onClick:l[1]||(l[1]=E=>a(_)())},{default:p(()=>[i(R,{icon:"mdi-keyboard-backspace"})]),_:1}),i(s,null,{default:p(()=>[i(D,{alt:a(e).profile.displayName,src:a(e).profile.photoURL},null,8,["alt","src"])]),_:1}),i(b,null,{default:p(()=>[i(d,{to:"../"+a(e).profile.username},{default:p(()=>[r("div",null,[r("p",null,[r("span",null,B(a(e).profile.displayName),1),be,r("span",ge,"@"+B(a(e).profile.username),1)])])]),_:1},8,["to"])]),_:1})]),_:1}),i(x,null,{default:p(()=>[i(t,{class:"ma-0 pa-0 mx-auto h-full"},{default:p(()=>[i(he,{active:a(e),to:f},null,8,["active","to"])]),_:1})]),_:1})]),_:1})}}};export{Ce as default};
